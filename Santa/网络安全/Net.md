# 🌐 网络基础与 HTTP 协议

---

## 1. HTTP/HTTPS

### 工作原理
- **HTTP**：无状态、无连接的协议，基于请求-响应模型。
- **HTTPS**：在 HTTP 基础上加入 SSL/TLS 加密层，确保数据传输的安全性。

### 常见请求方法
| 方法   | 说明                     |
|--------|--------------------------|
| GET    | 请求资源，参数在 URL 中  |
| POST   | 提交数据，参数在请求体中 |
| PUT    | 更新资源                 |
| DELETE | 删除资源                 |
| PATCH  | 部分更新资源             |
| HEAD   | 获取响应头信息           |

### HTTP 状态码详解

#### 1xx 信息类
| 状态码 | 说明 |
|--------|------|
| 100 | Continue，客户端应继续发送请求 |
| 101 | Switching Protocols，服务器同意切换协议 |

#### 2xx 成功类
| 状态码 | 说明 |
|--------|------|
| 200 | OK，请求成功 |
| 201 | Created，资源创建成功 |
| 202 | Accepted，请求已接受但未处理完成 |
| 204 | No Content，响应无内容 |

#### 3xx 重定向类
| 状态码 | 说明 |
|--------|------|
| 301 | Moved Permanently，永久重定向 |
| 302 | Found，临时重定向 |
| 304 | Not Modified，资源未修改，使用缓存 |

#### 4xx 客户端错误
| 状态码 | 说明 |
|--------|------|
| 400 | Bad Request，请求语法错误 |
| 401 | Unauthorized，需要身份验证 |
| 403 | Forbidden，服务器拒绝请求 |
| **404** | **Not Found，资源未找到** |
| 405 | Method Not Allowed，请求方法不被允许 |

#### 5xx 服务器错误
| 状态码 | 说明 |
|--------|------|
| **500** | **Internal Server Error，服务器内部错误** |
| 502 | Bad Gateway，网关错误 |
| 503 | Service Unavailable，服务不可用 |
| 504 | Gateway Timeout，网关超时 |

---

## 2. TCP 与 UDP

# 🔄 TCP 三次握手详解

## 三次握手全过程

### 第一次握手：SYN
**客户端 → 服务器**
- 客户端发送 **SYN=1** 标志的数据包
- 随机生成一个初始序列号 **seq = x**
- 进入 **SYN-SENT** 状态

**数据包结构：**
```
SYN = 1, seq = x
```

### 第二次握手：SYN-ACK
**服务器 → 客户端**
- 服务器收到 SYN 包后，发送 **SYN=1** 和 **ACK=1** 标志的数据包
- 确认号 **ack = x + 1**
- 随机生成服务器的初始序列号 **seq = y**
- 进入 **SYN-RECEIVED** 状态

**数据包结构：**
```
SYN = 1, ACK = 1, seq = y, ack = x + 1
```

### 第三次握手：ACK
**客户端 → 服务器**
- 客户端收到 SYN-ACK 包后，发送 **ACK=1** 标志的数据包
- 确认号 **ack = y + 1**
- 序列号 **seq = x + 1**
- 双方进入 **ESTABLISHED** 状态，连接建立完成

**数据包结构：**
```
ACK = 1, seq = x + 1, ack = y + 1
```

---

## 详细状态转换

### 客户端状态流转
```
CLOSED → SYN-SENT → ESTABLISHED
```

### 服务器状态流转
```
CLOSED → LISTEN → SYN-RECEIVED → ESTABLISHED
```

---

## 关键参数说明

### 标志位（Flags）
| 标志 | 名称 | 作用 |
|------|------|------|
| SYN | 同步序列号 | 建立连接时同步序列号 |
| ACK | 确认 | 确认数据包有效 |
| FIN | 结束 | 释放连接 |
| RST | 重置 | 重置连接 |

### 序列号机制
- **序列号（seq）**：标识发送的数据字节流
- **确认号（ack）**：期望收到的下一个字节的序列号
- **初始序列号**：随机生成，防止序列号预测攻击

---

## 为什么需要三次握手？

### 1. 防止已失效的连接请求
- 防止网络中延迟的旧连接请求突然到达服务器
- 避免服务器误以为客户端要建立新连接

### 2. 同步序列号
- 双方确认对方的发送能力和接收能力正常
- 交换初始序列号，为可靠传输奠定基础

### 3. 协商参数
- 协商窗口大小、最大报文长度等参数
- 确保双方都能正常通信

---

## 实际抓包示例

```
# 第一次握手
Source: 192.168.1.100:54321 → Destination: 93.184.216.34:80
Flags: [SYN], Seq=1000

# 第二次握手  
Source: 93.184.216.34:80 → Destination: 192.168.1.100:54321
Flags: [SYN, ACK], Seq=5000, Ack=1001

# 第三次握手
Source: 192.168.1.100:54321 → Destination: 93.184.216.34:80
Flags: [ACK], Seq=1001, Ack=5001
```

---

## 常见问题与故障排查

### 握手失败场景
1. **SYN 包丢失**：客户端超时重传
2. **SYN-ACK 包丢失**：服务器超时重传  
3. **ACK 包丢失**：服务器超时重传 SYN-ACK
4. **端口未监听**：服务器返回 RST 包

### 相关 Linux 命令
```bash
# 查看 TCP 连接状态
netstat -ant | grep :80

# 查看 SYN 队列溢出
netstat -s | grep -i listen

# 使用 tcpdump 抓包分析
tcpdump -i any tcp port 80
```

### 内核参数调优
```bash
# 调整 SYN 队列大小
echo 2048 > /proc/sys/net/ipv4/tcp_max_syn_backlog

# 启用 SYN Cookies 防御 SYN 洪水攻击
echo 1 > /proc/sys/net/ipv4/tcp_syncookies
```

---

## 四次挥手对比

### 三次握手（建立连接）
```
客户端: SYN →  
服务器: SYN-ACK →  
客户端: ACK
```

### 四次挥手（断开连接）
```
客户端: FIN →  
服务器: ACK →  
服务器: FIN →  
客户端: ACK
```

---

## ✅ 实践建议

1. **使用 Wireshark 实际观察**：过滤 `tcp.port == 80` 查看 HTTP 连接建立过程
2. **理解状态转换**：掌握各个状态的涵义，便于故障排查
3. **关注性能指标**：SYN 超时时间、重传次数等影响连接建立速度

通过深入理解三次握手，可以更好地诊断网络连接问题，优化应用性能。

### TCP 与 UDP 的区别
| 特性 | TCP | UDP |
|------|-----|-----|
| 连接方式 | 面向连接 | 无连接 |
| 可靠性 | 可靠传输，有确认机制 | 不可靠传输，尽最大努力交付 |
| 顺序性 | 保证数据顺序 | 不保证顺序 |
| 速度 | 较慢，有拥塞控制 | 较快，无拥塞控制 |
| 头部大小 | 20-60字节 | 8字节 |
| 应用场景 | 网页、邮件、文件传输 | 视频流、DNS、游戏、直播 |

---

## 3. 浏览器开发者工具 - Network 标签

### 主要功能
- **查看所有网络请求**：包括 HTML、CSS、JS、图片等资源
- **分析请求详情**：请求头、响应头、状态码、响应时间
- **性能分析**：资源加载时序、大小、缓存状态
- **筛选与搜索**：按类型、状态码、域名等筛选请求

### 常用列说明
- **Status**: 状态码（颜色标识：绿色-成功，黄色-重定向，红色-错误）
- **Type**: 资源类型（document, stylesheet, script, image等）
- **Initiator**: 请求发起者
- **Size**: 资源大小（来自缓存或网络）
- **Time**: 请求耗时

---

## 4. TCP/IP 四层模型

| 层级 | 功能 | 协议举例 |
|------|------|----------|
| 应用层 | 为用户应用程序提供网络服务 | HTTP, HTTPS, DNS, FTP, SMTP, SSH |
| 传输层 | 提供端到端的通信服务 | TCP, UDP |
| 网络层 | 负责数据包的寻址和路由 | IP, ICMP, ARP, IGMP |
| 网络接口层 | 负责物理传输 | Ethernet, Wi-Fi, PPP, MAC |

---

## 5. 网络基础概念

### IP 地址
- **IPv4**: 32位地址，格式：`192.168.1.1`，约42亿个地址
- **IPv6**: 128位地址，格式：`2001:0db8:85a3::8a2e:0370:7334`
- **公有IP**: 互联网唯一标识
- **私有IP**: 局域网内使用（`10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`）

### 子网掩码
- 用于划分 IP 地址的网络部分和主机部分
- 示例：`255.255.255.0` = `/24`，表示前24位为网络号
- 作用：减少网络广播，提高网络效率

### 网关
- 连接不同网络的设备，通常是路由器的 IP 地址
- 功能：协议转换、路由选择、数据包转发
- 默认网关：当目标IP不在本地网络时，数据包发送的地址

### DNS（域名系统）
- **作用**: 将域名解析为 IP 地址
- **查询过程**: 浏览器缓存 → 系统缓存 → 路由器缓存 → ISP DNS → 递归查询
- **记录类型**: A记录（IPv4）、AAAA记录（IPv6）、CNAME（别名）、MX（邮件交换）

---

## ✅ 实践建议

### 网络诊断命令
```bash
# 测试网络连通性
ping www.google.com

# 跟踪数据包路径
tracert www.google.com  # Windows
traceroute www.google.com  # Linux/macOS

# 查看网络配置
ipconfig  # Windows
ifconfig  # Linux/macOS

# DNS 查询
nslookup www.google.com
```

### 浏览器开发者工具使用技巧
1. **按类型筛选**: 可以只查看 XHR/Fetch 请求（API调用）
2. **保留日志**: 页面跳转时保持网络记录
3. **节流模拟**: 模拟慢速网络环境
4. **导出HAR**: 导出网络记录用于分析

### 抓包工具推荐
- **Wireshark**: 功能强大的网络协议分析工具
- **Fiddler**: HTTP/HTTPS 调试代理工具
- **Charles**: Web 调试代理工具，支持 SSL 代理

---

如果有新的想法，欢迎随时和我讨论！
