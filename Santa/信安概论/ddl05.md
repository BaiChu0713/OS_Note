# 第七章 网络安全

## 网络安全

- 网络安全
  网络系统的**硬件**与**软件**及其系统中的数据受到保护，不因偶然的或恶意的原因而遭到**破坏、更改、泄露**，系统连续可靠正常地运行，网络服务不中断

- 涉及的内容

  1. 运行系统的安全（主机本机）
  2. 网络上系统信息的安全
  3. 网络上信息传播的安全
  4. 网络上信息内容的安全

- 网络安全的属性
 1. 机密性：不被非授权者获取或使用；在数据的传输和存储过程中不被获取/解析数据
 2. 完整性：信息真实可信，不被伪造，内容不被篡改
 3. 可用性：信息与信息系统可被授权人正常使用，系统时刻能为授权人提供服务
 4. 可审性：身份鉴别：你知道什么？你有什么？你是什么？双因子身份鉴别

- 网络安全体系层次
  - 物理层，系统层安全，网络层安全，应用层安全，管理层安全

## 网络安全风险分析

- 风险：丢失需要保护的资产的可能性

  - 组成部分：

    漏洞（攻击的可能的途径）

    威胁（可能破坏网络系统环境安全的动作）

    威胁的组成：
    ![photo](/Photos/17.png)
- 资产：数据/硬件/软件/服务

- 威胁分析：

  |层级|威胁|威胁方法|
  |-|-|-|
  |物理层|设备、系统质量问题，设备线路损坏，管理不力|盗窃、破坏、自然灾害|
  |系统层|系统缺陷、漏洞、OS安全配置|病毒、DDOS攻击|
  |网络层|路由器等网络设备质量问题、损坏、非法访问|切断线路、翻墙|
  |应用层|信息泄露、恶意软件、软件漏洞|病毒、恶意软件、钓鱼诈骗|
  |管理层|制度、纪律、职责、培训|违规、违纪、违法|

- 网络攻击
当然，以下是关于这五种常见网络攻击的详细介绍：

### 1. 密码攻击（Password Attack）
**定义**：密码攻击是指攻击者通过各种手段获取或破解用户密码，从而非法访问系统或获取敏感信息。

**常见方法**：
- **暴力破解（Brute Force）**：尝试所有可能的密码组合，直到找到正确的密码。这种方法对较短的密码特别有效，但对较长的密码可能需要很长时间。
- **字典攻击（Dictionary Attack）**：使用预先准备好的常见密码列表（字典）进行尝试。这种方法比暴力破解更快，但只能破解使用常见密码的账户。
- **彩虹表攻击（Rainbow Table Attack）**：使用预先计算好的哈希值表来快速破解哈希密码。这种方法对简单哈希算法（如MD5）特别有效，但对加盐哈希（salted hash）效果较差。
- **社会工程学攻击（Social Engineering）**：通过欺骗或操纵用户，获取他们的密码。例如，通过电话或电子邮件伪装成合法的系统管理员，诱使用户提供密码。

**防范措施**：
- 使用强密码策略，包括长度、复杂性和定期更换密码。
- 使用多因素认证（MFA），增加额外的安全层。
- 教育用户识别和避免社会工程学攻击。

### 2. 网络扫描（Network Scanning）
**定义**：网络扫描是指攻击者通过扫描网络中的设备和服务，发现潜在的漏洞和攻击目标。

**常见方法**：
- **端口扫描（Port Scanning）**：检查目标主机上的开放端口，以确定运行的服务和可能的漏洞。
- **主机发现（Host Discovery）**：通过发送ICMP（Ping）或其他协议的请求，发现网络中的活跃主机。
- **服务识别（Service Identification）**：通过分析响应数据，确定目标主机上运行的服务和版本，以便查找已知漏洞。

**防范措施**：
- 使用防火墙和入侵检测系统（IDS）来检测和阻止未经授权的扫描。
- 定期更新和打补丁，确保系统和服务没有已知漏洞。
- 配置访问控制列表（ACL），限制对敏感服务的访问。

### 3. 网络监听（Network Sniffing）
**定义**：网络监听是指攻击者通过捕获和分析网络流量，获取敏感信息，如用户名、密码、信用卡信息等。

**常见方法**：
- **被动监听（Passive Sniffing）**：攻击者在网络中放置监听设备，捕获经过的网络流量。这种方法不需要主动发送数据包，因此较难被发现。
- **主动监听（Active Sniffing）**：攻击者通过发送伪造的数据包，诱导目标系统响应，从而捕获敏感信息。例如，通过ARP欺骗（ARP Spoofing）或DNS欺骗（DNS Spoofing）。

**防范措施**：
- 使用加密协议（如HTTPS、SSL/TLS、VPN）来保护网络流量。
- 配置网络设备（如交换机）的访问控制，防止未经授权的设备接入网络。
- 定期监控网络流量，检测异常行为。

### 4. 缓冲区溢出漏洞利用（Buffer Overflow Exploitation）
**定义**：缓冲区溢出是指攻击者通过向程序的缓冲区输入超过其容量的数据，覆盖相邻内存区域，从而导致程序崩溃或执行恶意代码。

**常见方法**：
- **堆栈溢出（Stack Overflow）**：攻击者通过覆盖堆栈上的返回地址，使程序跳转到攻击者控制的代码。
- **堆溢出（Heap Overflow）**：攻击者通过破坏堆的管理结构，导致程序执行恶意代码。
- **格式化字符串漏洞（Format String Vulnerability）**：攻击者通过控制格式化字符串，读取或写入内存中的任意位置。

**防范措施**：
- 使用安全的编程实践，避免使用不安全的函数（如`strcpy`、`sprintf`）。
- 使用编译器提供的缓冲区溢出保护机制（如GCC的`-fstack-protector`）。
- 定期更新和打补丁，修复已知的缓冲区溢出漏洞。

### 5. SQL注入漏洞（SQL Injection Vulnerability）
**定义**：SQL注入是指攻击者通过在输入字段中插入恶意SQL代码，干扰数据库的正常查询，从而获取、修改或删除敏感数据。

**常见方法**：
- **经典SQL注入**：攻击者通过在输入字段中插入SQL语句，干扰数据库的正常查询。例如，通过在登录表单中输入`' OR '1'='1`，绕过身份验证。
- **盲注SQL注入（Blind SQL Injection）**：攻击者通过观察应用程序的响应，推断SQL查询的结果。例如，通过测量响应时间或观察错误消息，判断SQL查询的真假。
- **基于时间的SQL注入（Time-Based SQL Injection）**：攻击者通过插入延迟SQL语句，根据响应时间判断SQL查询的结果。

**防范措施**：
- 使用参数化查询（Prepared Statements）或ORM（对象关系映射）工具，避免直接拼接SQL语句。
- 对用户输入进行严格的验证和过滤，防止恶意输入。
- 配置数据库的最小权限原则，限制应用程序对数据库的访问权限。

### 6. 拒绝服务攻击（Denial of Service，DoS）

**定义**：拒绝服务攻击（DoS）是一种网络攻击，其目的是使目标系统或网络无法正常提供服务，从而导致合法用户无法访问资源。这种攻击通常通过发送大量的请求或数据包，使目标系统或网络的资源耗尽，导致系统崩溃或无法响应。

**攻击类型**

#### 1. **单点拒绝服务攻击（DoS）**
- **定义**：单点拒绝服务攻击是指攻击者从一个或少数几个源发送大量的请求或数据包，使目标系统或网络的资源耗尽。
- **常见方法**：
  - **SYN Flood**：攻击者发送大量的SYN请求到目标服务器，但不完成TCP三次握手过程，导致服务器的连接队列被占满，无法处理新的连接请求。
  - **UDP Flood**：攻击者发送大量的UDP数据包到目标服务器，使服务器的网络带宽和处理能力耗尽。
  - **ICMP Flood**：攻击者发送大量的ICMP请求（如Ping）到目标服务器，使服务器的网络带宽和处理能力耗尽。

#### 2. **分布式拒绝服务攻击（Distributed Denial of Service，DDoS）**
- **定义**：分布式拒绝服务攻击是指攻击者利用多个受控的计算机（通常称为“僵尸网络”）同时对目标系统或网络发起攻击，使目标系统或网络的资源耗尽。
- **常见方法**：
  - **反射攻击（Reflection Attack）**：攻击者利用第三方服务器（如DNS服务器、NTP服务器）反射攻击流量，使目标系统或网络的资源耗尽。例如，DNS反射攻击通过发送大量的DNS查询请求到第三方DNS服务器，使DNS服务器将响应数据发送到目标系统。
  - **放大攻击（Amplification Attack）**：攻击者利用某些协议的特性，使攻击流量在传输过程中被放大。例如，NTP放大攻击通过发送少量的NTP请求，使NTP服务器返回大量的响应数据到目标系统。
  - **应用层攻击（Application Layer Attack）**：攻击者针对特定的应用层协议（如HTTP、HTTPS）发起攻击，使目标服务器的处理能力耗尽。例如，HTTP Flood攻击通过发送大量的HTTP请求到目标服务器，使服务器的处理能力耗尽。

##### 攻击目标
- **网络资源**：攻击者通过发送大量的数据包，使目标网络的带宽耗尽，导致合法用户无法访问网络资源。
- **服务器资源**：攻击者通过发送大量的请求，使目标服务器的CPU、内存和磁盘I/O等资源耗尽，导致服务器无法正常响应。
- **应用资源**：攻击者通过发送大量的应用层请求，使目标应用的处理能力耗尽，导致应用无法正常响应。

##### 防范措施
1. **网络层面**：
   - **带宽管理**：配置网络设备（如路由器、防火墙）的流量管理功能，限制异常流量的带宽占用。
   - **访问控制**：配置访问控制列表（ACL），限制来自特定IP地址或网络的流量。
   - **流量过滤**：使用防火墙和入侵检测系统（IDS）来检测和过滤异常流量。
   - **分布式防火墙**：部署分布式防火墙，分散攻击流量，减轻单点压力。

2. **服务器层面**：
   - **资源限制**：配置服务器的资源限制（如CPU、内存、磁盘I/O），防止资源被耗尽。
   - **连接限制**：配置服务器的连接限制（如最大连接数、连接超时时间），防止连接队列被占满。
   - **应用层防护**：部署应用层防火墙（WAF），检测和阻止应用层攻击。

3. **应用层面**：
   - **输入验证**：对用户输入进行严格的验证和过滤，防止恶意输入。
   - **缓存机制**：使用缓存机制，减少应用层的处理负担。
   - **负载均衡**：部署负载均衡设备，分散应用层请求，减轻单点压力。

4. **监控与响应**：
   - **实时监控**：部署监控系统，实时监控网络和服务器的流量和性能指标。
   - **快速响应**：建立应急响应机制，快速响应和处理攻击事件。



## 防火墙技术

是位于**两个信任程度不同**的网络之间的**软件或硬件设备的组合**，它对两个网络之间的通信进行控制，通过**强制实施统一**的安全策略，防止对重要信息资源的非法存取和访问

防火墙可以**根据访问控制规则**决定进出网络的行为


### 防火墙的主要功能

1. **访问控制**：
   - **定义**：防火墙根据预定义的访问控制规则，决定允许或拒绝特定的网络流量通过。
   - **实现方式**：通过配置访问控制列表（ACL），防火墙可以基于源地址、目的地址、协议类型、端口号等信息来控制流量。
   - **例子**：允许内部网络的用户访问外部网络的Web服务（HTTP/HTTPS），但禁止外部网络的用户访问内部网络的敏感资源。

2. **网络地址转换（NAT）**：
   - **定义**：NAT是一种将一个IP地址空间转换为另一个IP地址空间的技术，通常用于隐藏内部网络的IP地址。
   - **实现方式**：防火墙可以配置NAT规则，将内部网络的私有IP地址转换为外部网络的公共IP地址。
   - **例子**：内部网络的用户使用私有IP地址（如192.168.1.x），通过防火墙的NAT功能，这些用户可以访问外部网络，而外部网络无法直接访问内部网络的私有IP地址。

3. **状态检测**：
   - **定义**：状态检测防火墙不仅检查数据包的头部信息，还会跟踪数据包的状态，确保数据包的合法性。
   - **实现方式**：通过维护一个状态表，防火墙可以记录每个连接的状态信息，如连接的源地址、目的地址、端口号、协议类型等。
   - **例子**：如果一个外部用户尝试向内部网络发送一个TCP数据包，但该数据包不属于任何已知的连接，防火墙将拒绝该数据包。

4. **入侵检测与防御**：
   - **定义**：防火墙可以集成入侵检测系统（IDS）和入侵防御系统（IPS），实时监控网络流量，检测和阻止恶意行为。
   - **实现方式**：通过配置安全规则和签名，防火墙可以识别和阻止已知的攻击模式，如端口扫描、SYN Flood攻击等。
   - **例子**：防火墙检测到一个IP地址频繁发送SYN请求，但不完成TCP三次握手过程，判断为SYN Flood攻击，自动阻止该IP地址的流量。

5. **日志记录与审计**：
   - **定义**：防火墙可以记录所有通过或被拒绝的流量信息，生成详细的日志文件，用于安全审计和故障排查。
   - **实现方式**：防火墙可以配置日志记录功能，将日志信息发送到中央日志服务器或本地存储。
   - **例子**：防火墙记录了所有访问外部Web服务的流量，管理员可以通过分析日志文件，发现异常行为或潜在的安全威胁。

### 防火墙的类型

1. **包过滤防火墙（Packet Filtering Firewall）**：
   - **特点**：基于数据包的头部信息（如源地址、目的地址、协议类型、端口号）进行过滤。
   - **优点**：简单、高效，对网络性能影响小。
   - **缺点**：无法检测数据包的内容，容易被绕过。

2. **状态检测防火墙（Stateful Inspection Firewall）**：
   - **特点**：不仅检查数据包的头部信息，还会跟踪数据包的状态，确保数据包的合法性。
   - **优点**：安全性高，能够有效防止多种攻击。
   - **缺点**：实现复杂，对网络性能有一定影响。

3. **应用层防火墙（Application Layer Firewall）**：
   - **特点**：在应用层对数据包进行检查和过滤，能够理解应用层协议的内容。
   - **优点**：安全性高，能够检测和阻止应用层攻击。
   - **缺点**：实现复杂，对网络性能影响较大。

4. **下一代防火墙（Next-Generation Firewall，NGFW）**：
   - **特点**：集成了多种安全功能，如入侵检测、入侵防御、反病毒、内容过滤等。
   - **优点**：功能强大，能够提供全面的安全保护。
   - **缺点**：价格较高，配置和管理复杂。

### 防火墙的部署方式

1. **透明模式（Transparent Mode）**：
   - **特点**：防火墙在透明模式下工作时，对网络拓扑结构没有影响，数据包直接通过防火墙。
   - **优点**：对网络拓扑结构影响小，配置简单。
   - **缺点**：无法进行NAT转换。

2. **路由模式（Routing Mode）**：
   - **特点**：防火墙在路由模式下工作时，数据包需要经过防火墙的路由处理。
   - **优点**：可以进行NAT转换，安全性高。
   - **缺点**：对网络拓扑结构有影响，配置复杂。

3. **混合模式（Hybrid Mode）**：
   - **特点**：结合了透明模式和路由模式的优点，可以根据需要选择不同的工作模式。
   - **优点**：灵活性高，适应性强。
   - **缺点**：配置和管理复杂。

### 防火墙的配置与管理

1. **访问控制规则**：
   - **定义**：访问控制规则是防火墙的核心配置，决定了哪些流量可以进入或离开网络。
   - **配置方法**：通过配置访问控制列表（ACL），管理员可以定义允许或拒绝特定流量的规则。
   - **例子**：
     ```plaintext
     allow tcp any 192.168.1.0/24 port 80
     deny tcp any 192.168.1.0/24 port 23
     ```

2. **日志记录与审计**：
   - **定义**：防火墙可以记录所有通过或被拒绝的流量信息，生成详细的日志文件，用于安全审计和故障排查。
   - **配置方法**：通过配置日志记录功能，管理员可以将日志信息发送到中央日志服务器或本地存储。
   - **例子**：
     ```plaintext
     log all to syslog server 192.168.1.100
     ```

3. **安全策略**：
   - **定义**：安全策略是防火墙的总体安全配置，包括访问控制规则、NAT规则、入侵检测规则等。
   - **配置方法**：通过配置安全策略，管理员可以定义防火墙的整体行为。
   - **例子**：
     ```plaintext
     policy name "Web Access"
     rule 1 allow tcp any 192.168.1.0/24 port 80
     rule 2 deny tcp any 192.168.1.0/24 port 23
     ```
